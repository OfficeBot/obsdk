!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).officebotSdk=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){let SDK=function(Promise){let Settings=require("./src/settings.js");return Settings.setPromiseLib(Promise),{API:require("./src/api-config.class"),Cache:require("./src/cache.class"),EndpointConfig:require("./src/endpoint-config.class"),Endpoint:require("./src/endpoint.class"),HTTPMock:require("./src/http-mock.class"),Model:require("./src/model.class"),Request:require("./src/request.class"),Settings:Settings,Tranport:require("./src/transport.class"),URLBuilder:require("./src/url-builder.class"),Utils:require("./src/utils.class")}}(Promise);module.exports=SDK},{"./src/api-config.class":11,"./src/cache.class":12,"./src/endpoint-config.class":13,"./src/endpoint.class":14,"./src/http-mock.class":15,"./src/model.class":16,"./src/request.class":17,"./src/settings.js":18,"./src/transport.class":19,"./src/url-builder.class":20,"./src/utils.class":21}],2:[function(require,module,exports){function isUndefinedOrNull(value){return null===value||void 0===value}function isBuffer(x){return!(!x||"object"!=typeof x||"number"!=typeof x.length)&&("function"==typeof x.copy&&"function"==typeof x.slice&&!(x.length>0&&"number"!=typeof x[0]))}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return!1;if(a.prototype!==b.prototype)return!1;if(isArguments(a))return!!isArguments(b)&&(a=pSlice.call(a),b=pSlice.call(b),deepEqual(a,b,opts));if(isBuffer(a)){if(!isBuffer(b))return!1;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0}try{var ka=objectKeys(a),kb=objectKeys(b)}catch(e){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!deepEqual(a[key],b[key],opts))return!1;return typeof a==typeof b}var pSlice=Array.prototype.slice,objectKeys=require("./lib/keys.js"),isArguments=require("./lib/is_arguments.js"),deepEqual=module.exports=function(actual,expected,opts){return opts||(opts={}),actual===expected||(actual instanceof Date&&expected instanceof Date?actual.getTime()===expected.getTime():!actual||!expected||"object"!=typeof actual&&"object"!=typeof expected?opts.strict?actual===expected:actual==expected:objEquiv(actual,expected,opts))}},{"./lib/is_arguments.js":3,"./lib/keys.js":4}],3:[function(require,module,exports){function supported(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function unsupported(object){return object&&"object"==typeof object&&"number"==typeof object.length&&Object.prototype.hasOwnProperty.call(object,"callee")&&!Object.prototype.propertyIsEnumerable.call(object,"callee")||!1}var supportsArgumentsClass="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(exports=module.exports=supportsArgumentsClass?supported:unsupported).supported=supported,exports.unsupported=unsupported},{}],4:[function(require,module,exports){function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys}(module.exports="function"==typeof Object.keys?Object.keys:shim).shim=shim},{}],5:[function(require,module,exports){function getValueByPointer(document,pointer){if(""==pointer)return document;var getOriginalDestination={op:"_get",path:pointer};return applyOperation(document,getOriginalDestination),getOriginalDestination.value}function applyOperation(document,operation,validateOperation,mutateDocument){if(void 0===validateOperation&&(validateOperation=!1),void 0===mutateDocument&&(mutateDocument=!0),validateOperation&&("function"==typeof validateOperation?validateOperation(operation,0,document,operation.path):validator(operation,0)),""===operation.path){var returnValue={newDocument:document};if("add"===operation.op)return returnValue.newDocument=operation.value,returnValue;if("replace"===operation.op)return returnValue.newDocument=operation.value,returnValue.removed=document,returnValue;if("move"===operation.op||"copy"===operation.op)return returnValue.newDocument=getValueByPointer(document,operation.from),"move"===operation.op&&(returnValue.removed=document),returnValue;if("test"===operation.op){if(returnValue.test=areEquals(document,operation.value),!1===returnValue.test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue.newDocument=document,returnValue}if("remove"===operation.op)return returnValue.removed=document,returnValue.newDocument=null,returnValue;if("_get"===operation.op)return operation.value=document,returnValue;if(validateOperation)throw new exports.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,operation,document);return returnValue}mutateDocument||(document=helpers_1._deepClone(document));var keys=(operation.path||"").split("/"),obj=document,t=1,len=keys.length,existingPathFragment=void 0,key=void 0,validateFunction=void 0;for(validateFunction="function"==typeof validateOperation?validateOperation:validator;;){if(key=keys[t],validateOperation&&void 0===existingPathFragment&&(void 0===obj[key]?existingPathFragment=keys.slice(0,t).join("/"):t==len-1&&(existingPathFragment=operation.path),void 0!==existingPathFragment&&validateFunction(operation,0,document,existingPathFragment)),t++,Array.isArray(obj)){if("-"===key)key=obj.length;else{if(validateOperation&&!helpers_1.isInteger(key))throw new exports.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,operation.path,operation);helpers_1.isInteger(key)&&(key=~~key)}if(t>=len){if(validateOperation&&"add"===operation.op&&key>obj.length)throw new exports.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,operation.path,operation);if(!1===(returnValue=arrOps[operation.op].call(operation,obj,key,document)).test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue}}else if(key&&-1!=key.indexOf("~")&&(key=helpers_1.unescapePathComponent(key)),t>=len){if(!1===(returnValue=objOps[operation.op].call(operation,obj,key,document)).test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue}obj=obj[key]}}function applyPatch(document,patch,validateOperation){if(validateOperation&&!Array.isArray(patch))throw new exports.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");for(var results=new Array(patch.length),i=0,length_1=patch.length;i<length_1;i++)results[i]=applyOperation(document,patch[i],validateOperation),document=results[i].newDocument;return results.newDocument=document,results}function validator(operation,index,document,existingPathFragment){if("object"!=typeof operation||null===operation||Array.isArray(operation))throw new exports.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",index,operation,document);if(!objOps[operation.op])throw new exports.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",index,operation,document);if("string"!=typeof operation.path)throw new exports.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",index,operation,document);if(0!==operation.path.indexOf("/")&&operation.path.length>0)throw new exports.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",index,operation,document);if(("move"===operation.op||"copy"===operation.op)&&"string"!=typeof operation.from)throw new exports.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&void 0===operation.value)throw new exports.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&helpers_1.hasUndefined(operation.value))throw new exports.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",index,operation,document);if(document)if("add"==operation.op){var pathLen=operation.path.split("/").length,existingPathLen=existingPathFragment.split("/").length;if(pathLen!==existingPathLen+1&&pathLen!==existingPathLen)throw new exports.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",index,operation,document)}else if("replace"===operation.op||"remove"===operation.op||"_get"===operation.op){if(operation.path!==existingPathFragment)throw new exports.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",index,operation,document)}else if("move"===operation.op||"copy"===operation.op){var error=validate([{op:"_get",path:operation.from,value:void 0}],document);if(error&&"OPERATION_PATH_UNRESOLVABLE"===error.name)throw new exports.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",index,operation,document)}}function validate(sequence,document,externalValidator){try{if(!Array.isArray(sequence))throw new exports.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(document)applyPatch(helpers_1._deepClone(document),helpers_1._deepClone(sequence),externalValidator||!0);else{externalValidator=externalValidator||validator;for(var i=0;i<sequence.length;i++)externalValidator(sequence[i],i,document,void 0)}}catch(e){if(e instanceof exports.JsonPatchError)return e;throw e}}var equalsOptions={strict:!0},_equals=require("deep-equal"),areEquals=function(a,b){return _equals(a,b,equalsOptions)},helpers_1=require("./helpers");exports.JsonPatchError=helpers_1.PatchError,exports.deepClone=helpers_1._deepClone;var objOps={add:function(obj,key,document){return obj[key]=this.value,{newDocument:document}},remove:function(obj,key,document){var removed=obj[key];return delete obj[key],{newDocument:document,removed:removed}},replace:function(obj,key,document){var removed=obj[key];return obj[key]=this.value,{newDocument:document,removed:removed}},move:function(obj,key,document){var removed=getValueByPointer(document,this.path);removed&&(removed=helpers_1._deepClone(removed));var originalValue=applyOperation(document,{op:"remove",path:this.from}).removed;return applyOperation(document,{op:"add",path:this.path,value:originalValue}),{newDocument:document,removed:removed}},copy:function(obj,key,document){var valueToCopy=getValueByPointer(document,this.from);return applyOperation(document,{op:"add",path:this.path,value:helpers_1._deepClone(valueToCopy)}),{newDocument:document}},test:function(obj,key,document){return{newDocument:document,test:areEquals(obj[key],this.value)}},_get:function(obj,key,document){return this.value=obj[key],{newDocument:document}}},arrOps={add:function(arr,i,document){return helpers_1.isInteger(i)?arr.splice(i,0,this.value):arr[i]=this.value,{newDocument:document,index:i}},remove:function(arr,i,document){return{newDocument:document,removed:arr.splice(i,1)[0]}},replace:function(arr,i,document){var removed=arr[i];return arr[i]=this.value,{newDocument:document,removed:removed}},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};exports.getValueByPointer=getValueByPointer,exports.applyOperation=applyOperation,exports.applyPatch=applyPatch,exports.applyReducer=function(document,operation){var operationResult=applyOperation(document,operation);if(!1===operationResult.test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return operationResult.newDocument},exports.validator=validator,exports.validate=validate},{"./helpers":7,"deep-equal":2}],6:[function(require,module,exports){function getMirror(obj){for(var i=0,length=beforeDict.length;i<length;i++)if(beforeDict[i].obj===obj)return beforeDict[i]}function getObserverFromMirror(mirror,callback){for(var j=0,length=mirror.observers.length;j<length;j++)if(mirror.observers[j].callback===callback)return mirror.observers[j].observer}function removeObserverFromMirror(mirror,observer){for(var j=0,length=mirror.observers.length;j<length;j++)if(mirror.observers[j].observer===observer)return void mirror.observers.splice(j,1)}function generate(observer){for(var mirror,i=0,length=beforeDict.length;i<length;i++)if(beforeDict[i].obj===observer.object){mirror=beforeDict[i];break}_generate(mirror.value,observer.object,observer.patches,""),observer.patches.length&&core_1.applyPatch(mirror.value,observer.patches);var temp=observer.patches;return temp.length>0&&(observer.patches=[],observer.callback&&observer.callback(temp)),temp}function _generate(mirror,obj,patches,path){if(obj!==mirror){"function"==typeof obj.toJSON&&(obj=obj.toJSON());for(var newKeys=helpers_1._objectKeys(obj),oldKeys=helpers_1._objectKeys(mirror),deleted=!1,t=oldKeys.length-1;t>=0;t--){var oldVal=mirror[key=oldKeys[t]];if(!helpers_1.hasOwnProperty(obj,key)||void 0===obj[key]&&void 0!==oldVal&&!1===Array.isArray(obj))patches.push({op:"remove",path:path+"/"+helpers_1.escapePathComponent(key)}),deleted=!0;else{var newVal=obj[key];"object"==typeof oldVal&&null!=oldVal&&"object"==typeof newVal&&null!=newVal?_generate(oldVal,newVal,patches,path+"/"+helpers_1.escapePathComponent(key)):oldVal!==newVal&&(!0,patches.push({op:"replace",path:path+"/"+helpers_1.escapePathComponent(key),value:helpers_1._deepClone(newVal)}))}}if(deleted||newKeys.length!=oldKeys.length)for(t=0;t<newKeys.length;t++){var key=newKeys[t];helpers_1.hasOwnProperty(mirror,key)||void 0===obj[key]||patches.push({op:"add",path:path+"/"+helpers_1.escapePathComponent(key),value:helpers_1._deepClone(obj[key])})}}}require("deep-equal");var helpers_1=require("./helpers"),core_1=require("./core"),core_2=require("./core");exports.applyOperation=core_2.applyOperation,exports.applyPatch=core_2.applyPatch,exports.applyReducer=core_2.applyReducer,exports.getValueByPointer=core_2.getValueByPointer,exports.validate=core_2.validate,exports.validator=core_2.validator;var helpers_2=require("./helpers");exports.JsonPatchError=helpers_2.PatchError,exports.deepClone=helpers_2._deepClone,exports.escapePathComponent=helpers_2.escapePathComponent,exports.unescapePathComponent=helpers_2.unescapePathComponent;var beforeDict=[],Mirror=function(){return function(obj){this.observers=[],this.obj=obj}}(),ObserverInfo=function(){return function(callback,observer){this.callback=callback,this.observer=observer}}();exports.unobserve=function(root,observer){observer.unobserve()},exports.observe=function(obj,callback){var observer,patches=[],mirror=getMirror(obj);if(mirror?observer=getObserverFromMirror(mirror,callback):(mirror=new Mirror(obj),beforeDict.push(mirror)),observer)return observer;if(observer={},mirror.value=helpers_1._deepClone(obj),callback){observer.callback=callback,observer.next=null;var dirtyCheck=function(){generate(observer)},fastCheck=function(){clearTimeout(observer.next),observer.next=setTimeout(dirtyCheck)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",fastCheck),window.addEventListener("keyup",fastCheck),window.addEventListener("mousedown",fastCheck),window.addEventListener("keydown",fastCheck),window.addEventListener("change",fastCheck)):(document.documentElement.attachEvent("onmouseup",fastCheck),document.documentElement.attachEvent("onkeyup",fastCheck),document.documentElement.attachEvent("onmousedown",fastCheck),document.documentElement.attachEvent("onkeydown",fastCheck),document.documentElement.attachEvent("onchange",fastCheck)))}return observer.patches=patches,observer.object=obj,observer.unobserve=function(){generate(observer),clearTimeout(observer.next),removeObserverFromMirror(mirror,observer),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",fastCheck),window.removeEventListener("keyup",fastCheck),window.removeEventListener("mousedown",fastCheck),window.removeEventListener("keydown",fastCheck)):(document.documentElement.detachEvent("onmouseup",fastCheck),document.documentElement.detachEvent("onkeyup",fastCheck),document.documentElement.detachEvent("onmousedown",fastCheck),document.documentElement.detachEvent("onkeydown",fastCheck)))},mirror.observers.push(new ObserverInfo(callback,observer)),observer},exports.generate=generate,exports.compare=function(tree1,tree2){var patches=[];return _generate(tree1,tree2,patches,""),patches}},{"./core":5,"./helpers":7,"deep-equal":2}],7:[function(require,module,exports){function hasOwnProperty(obj,key){return _hasOwnProperty.call(obj,key)}function _objectKeys(obj){if(Array.isArray(obj)){for(var keys=new Array(obj.length),k=0;k<keys.length;k++)keys[k]=""+k;return keys}if(Object.keys)return Object.keys(obj);keys=[];for(var i in obj)hasOwnProperty(obj,i)&&keys.push(i);return keys}function escapePathComponent(path){return-1===path.indexOf("/")&&-1===path.indexOf("~")?path:path.replace(/~/g,"~0").replace(/\//g,"~1")}function _getPathRecursive(root,obj){var found;for(var key in root)if(hasOwnProperty(root,key)){if(root[key]===obj)return escapePathComponent(key)+"/";if("object"==typeof root[key]&&""!=(found=_getPathRecursive(root[key],obj)))return escapePathComponent(key)+"/"+found}return""}function hasUndefined(obj){if(void 0===obj)return!0;if(obj)if(Array.isArray(obj)){for(var i=0,len=obj.length;i<len;i++)if(hasUndefined(obj[i]))return!0}else if("object"==typeof obj)for(var objKeys=_objectKeys(obj),objKeysLength=objKeys.length,i=0;i<objKeysLength;i++)if(hasUndefined(obj[objKeys[i]]))return!0;return!1}var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},_hasOwnProperty=Object.prototype.hasOwnProperty;exports.hasOwnProperty=hasOwnProperty,exports._objectKeys=_objectKeys,exports._deepClone=function(obj){switch(typeof obj){case"object":return JSON.parse(JSON.stringify(obj));case"undefined":return null;default:return obj}},exports.isInteger=function(str){for(var charCode,i=0,len=str.length;i<len;){if(!((charCode=str.charCodeAt(i))>=48&&charCode<=57))return!1;i++}return!0},exports.escapePathComponent=escapePathComponent,exports.unescapePathComponent=function(path){return path.replace(/~1/g,"/").replace(/~0/g,"~")},exports._getPathRecursive=_getPathRecursive,exports.getPath=function(root,obj){if(root===obj)return"/";var path=_getPathRecursive(root,obj);if(""===path)throw new Error("Object not found in root");return"/"+path},exports.hasUndefined=hasUndefined;var PatchError=function(_super){function PatchError(message,name,index,operation,tree){_super.call(this,message),this.message=message,this.name=name,this.index=index,this.operation=operation,this.tree=tree}return __extends(PatchError,_super),PatchError}(Error);exports.PatchError=PatchError},{}],8:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],9:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],10:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":8,"./encode":9}],11:[function(require,module,exports){const EndpointConfig=require("./endpoint-config.class.js"),Endpoint=require("./endpoint.class.js"),Cache=require("./cache.class"),clone=require("./utils.class").clone;class APIConfig{constructor(){this.config={headers:{},url:""},this.endpoints={},this.cache=new Cache}baseUrl(url){return void 0!==url?("string"==typeof url&&(this.config.url=url),this):this.config.url}endpoint(endpointName="__default"){let config=(new EndpointConfig).api(this);return this[endpointName]=new Endpoint(config),this[endpointName]}commonHeaders(headers){return void 0!==headers?(this.config.headers=headers,this):clone(this.config.headers)}}module.exports=APIConfig},{"./cache.class":12,"./endpoint-config.class.js":13,"./endpoint.class.js":14,"./utils.class":21}],12:[function(require,module,exports){class Cache{constructor(){this.objects=new Map,this.config={ttl:6e4}}get(name){let now=Date.now(),obj=this.objects.get(name);if(void 0!==obj&&now-obj[0]<this.config.ttl){let cachedObject=obj[1];return Object.defineProperty(cachedObject,"__fromCache",{value:!0}),cachedObject}return void this.objects.delete(name)}put(name,value){if("string"!=typeof name)throw new Error("Invalid name attribute");return"string"==typeof value&&(value=new String(value)),"number"==typeof value&&(value=new Number(value)),"boolean"==typeof value&&(value=new Boolean(value)),this.objects.set(name,[Date.now(),value]),!0}invalidate(name){return this.objects.delete(name)}setTTL(newTTL){if("number"!=typeof newTTL)throw new Error("Invalid TTL value");return this.config.ttl=newTTL,!0}}module.exports=Cache},{}],13:[function(require,module,exports){const Model=require("./model.class"),clone=require("./utils.class").clone;class EndpointConfig{constructor(config={}){this.config={api:{}};let defaults={url:"/",responseType:"application/json",instantiator:Model};Object.assign(this.config,defaults,clone(config))}mediaType(newType){return void 0!==newType?("string"==typeof newType&&(this.config.responseType=newType),this):this.config.responseType}api(config){return void 0!==config?("object"==typeof config&&null!==config&&(this.config.api=clone(config)),this):this.config.api}baseUrl(){return this.config.api&&this.config.api.baseUrl?this.config.api.baseUrl():""}url(newUrl){return void 0!==newUrl?("string"==typeof newUrl&&(this.config.url=newUrl),this):this.config.url}model(newFn){return void 0!==newFn?("function"==typeof newFn&&(this.config.instantiator=newFn),this):this.config.instantiator}}module.exports=EndpointConfig},{"./model.class":16,"./utils.class":21}],14:[function(require,module,exports){const URLBuilder=require("./url-builder.class"),Request=require("./request.class"),clone=require("./utils.class").clone,noop=require("./utils.class").noop;class Endpoint{constructor(endpointConfig={}){if(!endpointConfig||"function"!=typeof endpointConfig.model)throw new Error("Invalid endpoint configuration.");this.endpointConfig=clone(endpointConfig),this.config={allowFromCache:!0,method:"get",target:"",query:{}},this.cache=this.endpointConfig.api().cache}createNew(data={}){let root=this.endpointConfig.baseUrl()+this.endpointConfig.url();data["@root"]=root;let instance=new(this.endpointConfig.model())(data);return instance.config(this.endpointConfig),instance}model(instantiator){return void 0!==instantiator?(this.endpointConfig.model(instantiator),this):this.endpointConfig.model()}url(newUrl){return void 0!==newUrl?(this.endpointConfig.url(newUrl),this):this.endpointConfig.url()}findById(id){if("string"!=typeof id)throw new Error("Invalid model identifier");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.config.method="get",this}find(query){return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url()]),this.config.method="get",this.config.query.search=JSON.stringify(query),this}findByIdAndUpdate(id,body){if("string"!=typeof id)throw new Error("Invalid model identifier");if("object"!=typeof body)throw new Error("Invalid body object");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.body=body,this.config.method="put",this}findByIdAndRemove(id){if("string"!=typeof id)throw new Error("Invalid model identifier");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.config.method="delete",this}allowFromCache(allow){return void 0!==allow?("boolean"==typeof allow&&(this.config.allowFromCache=allow),this):this.config.allowFromCache}exec(cb=noop){let allowFromCache=this.allowFromCache(),modelConstructor=this.endpointConfig.model(),endpointConfig=this.endpointConfig,headers={};try{headers=this.endpointConfig.api().commonHeaders()}catch(e){}Object.assign(headers,this.config.headers);let request=(new Request).method(this.config.method).body(this.config.body||{}).query(this.config.query||{}).headers(headers||{}).url(this.config.target.toString());return new(require("./settings").getPromise())((resolve,reject)=>{if(this.hasCache()){let cachedObject=cache.get(request.url());if(cachedObject&&allowFromCache)return cb(null,cachedObject),resolve(cachedObject)}request.exec().then(response=>{let model,data=response.data;return Array.isArray(data)?model=data.map(item=>{let entry=new modelConstructor(item);return entry.config(endpointConfig),entry.__request=clone(request),entry}):((model=new modelConstructor(data)).config(endpointConfig),model.__request=clone(request)),this.hasCache()&&cache.put(request.url(),model),cb(null,model),resolve(model)}).catch(err=>(this.hasCache()&&cache.invalidate(request.url()),cb(err),reject(err)))})}skip(skipAmount=0){return"number"==typeof skipAmount&&(this.config.query.skip=skipAmount),this}limit(limitAmount=0){return"number"==typeof limitAmount&&(this.config.query.limit=limitAmount),this}select(fields=""){return Array.isArray(fields)&&(fields=fields.join(" ")),"string"==typeof fields&&(this.config.query.fields=fields),this}hasCache(){return this.cache&&"function"==typeof this.cache}}module.exports=Endpoint},{"./request.class":17,"./settings":18,"./url-builder.class":20,"./utils.class":21}],15:[function(require,module,exports){class HTTPMock{constructor(verbose=!1){this.listeners={},this.verbose=verbose}open(method,url){this.log(`Opening ${url} using ${method}`)}send(body){if(this.log(`Sending with ${body}`),"function"==typeof this.listeners.load){let mockResponse={response:{mock_response:!0,data:["obj1"]},responseText:"{'mock_response' : true}",status:200,statusText:"200",responseURL:"/mock-call"};Object.assign(this,mockResponse),this.listeners.load()}}getAllResponseHeaders(){return"Mock-Headers: true"}addEventListener(name,callback){this.log(`${name} listener registered`),this.listeners[name]=callback}setRequestHeader(header,value){return!0}log(message){!0===this.verbose&&console.log(message)}}module.exports=HTTPMock},{}],16:[function(require,module,exports){const jsonpatch=require("fast-json-patch"),clone=require("./utils.class").clone,noop=require("./utils.class").noop,Request=require("./request.class");class Model{constructor(data={}){Object.defineProperty(this,"__config",{enumerable:!1,writable:!0}),Object.defineProperty(this,"__response",{enumerable:!1,writable:!0}),Object.defineProperty(this,"__original",{value:data,writable:!0}),Object.defineProperty(this,"__revision",{value:Date.now(),writable:!0}),Object.assign(this,clone(data))}save(cb=noop){let headers={};try{headers=this.__config.api().commonHeaders()}catch(e){}let method=this.id?"put":"post",instance=this;return(new Request).url(this.makeHref()).method(method).headers(headers).body(this).exec().then(response=>(Object.assign(instance,clone(response.data)),instance.__revision=Date.now(),instance.__response=response,instance.makeClean(),cb(),instance)).catch(err=>{cb(err)})}changes(){let headers=this.__config.api().commonHeaders(),targetUrl=this["@changes"];return(new Request).url(targetUrl).query({search:{since:this.__revision}}).method("get").headers(headers).exec()}subscribe(onChange,ttl=3e3){return setInterval(()=>{this.changes().then(changeList=>{changeList&&changeList.length&&(this.__revision=Date.now(),onChange(changeList,Date.now()))})},ttl),this}update(){let headers=this.__config.api().commonHeaders(),patches=this.getDiffs(),targetUrl=this.makeHref(),instance=this;return(new Request).url(targetUrl).method("patch").headers(headers).body(patches).exec().then(response=>{Object.assign(instance,clone(response.data)),instance.__revision=Date.now(),instance.__response=response,instance.makeClean()})}config(endpointConfig={}){this.__config=endpointConfig}makeHref(){let correctHref;return"object"==typeof this.__config?(correctHref=this.__config.baseUrl()+this.__config.url(),"string"==typeof this.id&&(correctHref+=this.id)):correctHref="/__unit_test__",correctHref}getDiffs(){return jsonpatch.compare(this.__original,this)}isDirty(){return this.getDiffs().length>0}makeClean(){this.__original=clone(this)}remove(cb=noop){let headers={};try{headers=this.__config.api().commonHeaders()}catch(e){}let targetUrl=this.makeHref(),instance=this;return(new Request).url(targetUrl).method("delete").headers(headers).exec().then(response=>(instance.__response=response,cb())).catch(err=>cb(err))}}module.exports=Model},{"./request.class":17,"./utils.class":21,"fast-json-patch":6}],17:[function(require,module,exports){const Transport=require("./transport.class.js"),clone=require("./utils.class").clone;class Request{constructor(config={}){var defaults={method:"GET",url:"/",headers:{},data:void 0,responseType:"application/json",params:{}};this.config={},Object.assign(this.config,defaults,config)}exec(){let originalRequest=this;return new(require("./settings").getPromise())((resolve,reject)=>{originalRequest.transport=new Transport(originalRequest),originalRequest.transport.exec().then(function(response){return response.data=clone(response.response),response.request=originalRequest,resolve(response)},function(response){return response.request=originalRequest,reject(response)})})}query(newQuery){return void 0!==newQuery?("object"==typeof newQuery&&null!==newQuery&&(newQuery=clone(newQuery)),this.config.params=newQuery,this):this.config.params}method(newMethod){return void 0!==newMethod?("string"==typeof newMethod&&(this.config.method=newMethod),this):this.config.method}url(newUrl){return void 0!==newUrl?("string"==typeof newUrl&&(this.config.url=newUrl),this):this.config.url}headers(newHeaderObj){return void 0!==newHeaderObj?("object"==typeof newHeaderObj&&null!==newHeaderObj&&(this.config.headers=clone(newHeaderObj)),this):this.config.headers}body(newBody){return void 0!==newBody?("object"==typeof newBody&&null!==newBody&&(this.config.data=clone(newBody)),this):this.config.data}mediaType(newType){return void 0!==newType?("string"==typeof newType&&(this.config.responseType=newType),this):this.config.responseType}toJSON(){return clone(this.config)}}module.exports=Request},{"./settings":18,"./transport.class.js":19,"./utils.class":21}],18:[function(require,module,exports){let settings={_p:Promise,setPromiseLib:function(p){this._p=p},getPromise:function(){return this._p}};module.exports=settings},{}],19:[function(require,module,exports){const clone=require("./utils.class").clone,querystring=require("querystring");class Transport{constructor(request){"undefined"!=typeof window&&window.XMLHttpRequest?this.HTTPRequest=window.XMLHttpRequest:this.HTTPRequest=require("./http-mock.class.js"),this.setRequest(request)}setRequest(request){return this.request=clone(request),this}exec(){let instance=this;return new(require("./settings").getPromise())((resolve,reject)=>{let httpInstance=new instance.HTTPRequest,url=instance.request.url(),query=querystring.stringify(instance.request.query());query&&query.length&&(url=url+"?"+query);let body=instance.request.body();"object"==typeof body&&(body=JSON.stringify(body)),httpInstance.addEventListener("load",function(){httpInstance.status<400?resolve(httpInstance):reject(httpInstance)}),httpInstance.addEventListener("error",function(e){reject(httpInstance)}),httpInstance.addEventListener("abort",function(){let failed=new Error("Transfer cancelled.");reject(failed)}),httpInstance.open(instance.request.method().toUpperCase(),url),httpInstance.responseType="json";let headers=instance.request.headers();httpInstance.setRequestHeader("Content-Type",instance.request.mediaType());for(let headerName in headers)httpInstance.setRequestHeader(headerName,headers[headerName]);httpInstance.send(body)})}}module.exports=Transport},{"./http-mock.class.js":15,"./settings":18,"./utils.class":21,querystring:10}],20:[function(require,module,exports){class URLBuilder{constructor(args=[]){if(!args||"function"!=typeof args.join)throw new Error("URL Builder requires param 1 to be an array.");this.target=args.filter(item=>"/"!==item).join("/")||"/"}toString(){return this.target||""}}module.exports=URLBuilder},{}],21:[function(require,module,exports){function privateClone(obj){if(null===obj||"object"!=typeof obj)return obj;var temp=new obj.constructor;for(var key in obj)temp[key]=privateClone(obj[key]);return temp}class Utils{constructor(){}static noop(){}static clone(obj){return privateClone(obj)}}module.exports=Utils},{}]},{},[1])(1)});
