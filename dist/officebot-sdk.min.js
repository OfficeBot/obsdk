!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).officebotSdk=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){let SDK=function(Promise){let Settings=require("./src/settings.js");return Settings.setPromiseLib(Promise),{API:require("./src/api-config.class"),Cache:require("./src/cache.class"),EndpointConfig:require("./src/endpoint-config.class"),Endpoint:require("./src/endpoint.class"),HTTPMock:require("./src/http-mock.class"),Model:require("./src/model.class"),Request:require("./src/request.class"),Settings:Settings,Tranport:require("./src/transport.class"),URLBuilder:require("./src/url-builder.class"),Utils:require("./src/utils.class")}}(Promise);module.exports=SDK},{"./src/api-config.class":15,"./src/cache.class":16,"./src/endpoint-config.class":17,"./src/endpoint.class":18,"./src/http-mock.class":19,"./src/model.class":20,"./src/request.class":21,"./src/settings.js":22,"./src/transport.class":23,"./src/url-builder.class":24,"./src/utils.class":25}],2:[function(require,module,exports){"use strict";function placeHoldersCount(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}exports.byteLength=function(b64){return 3*b64.length/4-placeHoldersCount(b64)},exports.toByteArray=function(b64){var i,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64),arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],3:[function(require,module,exports){"use strict";function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError("Invalid typed array length");var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return isArrayBuffer(value)?fromArrayBuffer(value,encodingOrOffset,length):"string"==typeof value?fromString(value,encodingOrOffset):fromObject(value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromString(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),buf.__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(obj){if(isArrayBufferView(obj)||"length"in obj)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(isArrayBufferView(string)||isArrayBuffer(string))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,numberIsNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if((str=str.trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)hi=(c=str.charCodeAt(i))>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||null!=obj&&null!=obj.constructor&&"ArrayBuffer"===obj.constructor.name&&"number"==typeof obj.byteLength}function isArrayBufferView(obj){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function(length){return+length!=length&&(length=0),Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g},{"base64-js":2,ieee754:11}],4:[function(require,module,exports){(function(Buffer){var clone=function(){"use strict";function _instanceof(obj,type){return null!=type&&obj instanceof type}function clone(parent,circular,depth,prototype,includeNonEnumerable){function _clone(parent,depth){if(null===parent)return null;if(0===depth)return parent;var child,proto;if("object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,nativePromise))child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})});else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=new Buffer(parent.length),parent.copy(child),child;_instanceof(parent,Error)?child=Object.create(parent):void 0===prototype?(proto=Object.getPrototypeOf(parent),child=Object.create(proto)):(child=Object.create(prototype),proto=prototype)}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent),allChildren.push(child)}_instanceof(parent,nativeMap)&&parent.forEach(function(value,key){var keyChild=_clone(key,depth-1),valueChild=_clone(value,depth-1);child.set(keyChild,valueChild)}),_instanceof(parent,nativeSet)&&parent.forEach(function(value){var entryChild=_clone(value,depth-1);child.add(entryChild)});for(var i in parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i)),attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols)for(var symbols=Object.getOwnPropertySymbols(parent),i=0;i<symbols.length;i++){var symbol=symbols[i];(!(descriptor=Object.getOwnPropertyDescriptor(parent,symbol))||descriptor.enumerable||includeNonEnumerable)&&(child[symbol]=_clone(parent[symbol],depth-1),descriptor.enumerable||Object.defineProperty(child,symbol,{enumerable:!1}))}if(includeNonEnumerable)for(var allPropertyNames=Object.getOwnPropertyNames(parent),i=0;i<allPropertyNames.length;i++){var propertyName=allPropertyNames[i],descriptor=Object.getOwnPropertyDescriptor(parent,propertyName);descriptor&&descriptor.enumerable||(child[propertyName]=_clone(parent[propertyName],depth-1),Object.defineProperty(child,propertyName,{enumerable:!1}))}return child}"object"==typeof circular&&(depth=circular.depth,prototype=circular.prototype,includeNonEnumerable=circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer=void 0!==Buffer;return void 0===circular&&(circular=!0),void 0===depth&&(depth=1/0),_clone(parent,depth)}function __objToStr(o){return Object.prototype.toString.call(o)}function __getRegExpFlags(re){var flags="";return re.global&&(flags+="g"),re.ignoreCase&&(flags+="i"),re.multiline&&(flags+="m"),flags}var nativeMap;try{nativeMap=Map}catch(_){nativeMap=function(){}}var nativeSet;try{nativeSet=Set}catch(_){nativeSet=function(){}}var nativePromise;try{nativePromise=Promise}catch(_){nativePromise=function(){}}return clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};return c.prototype=parent,new c},clone.__objToStr=__objToStr,clone.__isDate=function(o){return"object"==typeof o&&"[object Date]"===__objToStr(o)},clone.__isArray=function(o){return"object"==typeof o&&"[object Array]"===__objToStr(o)},clone.__isRegExp=function(o){return"object"==typeof o&&"[object RegExp]"===__objToStr(o)},clone.__getRegExpFlags=__getRegExpFlags,clone}();"object"==typeof module&&module.exports&&(module.exports=clone)}).call(this,require("buffer").Buffer)},{buffer:3}],5:[function(require,module,exports){function isUndefinedOrNull(value){return null===value||void 0===value}function isBuffer(x){return!(!x||"object"!=typeof x||"number"!=typeof x.length)&&("function"==typeof x.copy&&"function"==typeof x.slice&&!(x.length>0&&"number"!=typeof x[0]))}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return!1;if(a.prototype!==b.prototype)return!1;if(isArguments(a))return!!isArguments(b)&&(a=pSlice.call(a),b=pSlice.call(b),deepEqual(a,b,opts));if(isBuffer(a)){if(!isBuffer(b))return!1;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0}try{var ka=objectKeys(a),kb=objectKeys(b)}catch(e){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!deepEqual(a[key],b[key],opts))return!1;return typeof a==typeof b}var pSlice=Array.prototype.slice,objectKeys=require("./lib/keys.js"),isArguments=require("./lib/is_arguments.js"),deepEqual=module.exports=function(actual,expected,opts){return opts||(opts={}),actual===expected||(actual instanceof Date&&expected instanceof Date?actual.getTime()===expected.getTime():!actual||!expected||"object"!=typeof actual&&"object"!=typeof expected?opts.strict?actual===expected:actual==expected:objEquiv(actual,expected,opts))}},{"./lib/is_arguments.js":6,"./lib/keys.js":7}],6:[function(require,module,exports){function supported(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function unsupported(object){return object&&"object"==typeof object&&"number"==typeof object.length&&Object.prototype.hasOwnProperty.call(object,"callee")&&!Object.prototype.propertyIsEnumerable.call(object,"callee")||!1}var supportsArgumentsClass="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(exports=module.exports=supportsArgumentsClass?supported:unsupported).supported=supported,exports.unsupported=unsupported},{}],7:[function(require,module,exports){function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys}(module.exports="function"==typeof Object.keys?Object.keys:shim).shim=shim},{}],8:[function(require,module,exports){function getValueByPointer(document,pointer){if(""==pointer)return document;var getOriginalDestination={op:"_get",path:pointer};return applyOperation(document,getOriginalDestination),getOriginalDestination.value}function applyOperation(document,operation,validateOperation,mutateDocument){if(void 0===validateOperation&&(validateOperation=!1),void 0===mutateDocument&&(mutateDocument=!0),validateOperation&&("function"==typeof validateOperation?validateOperation(operation,0,document,operation.path):validator(operation,0)),""===operation.path){var returnValue={newDocument:document};if("add"===operation.op)return returnValue.newDocument=operation.value,returnValue;if("replace"===operation.op)return returnValue.newDocument=operation.value,returnValue.removed=document,returnValue;if("move"===operation.op||"copy"===operation.op)return returnValue.newDocument=getValueByPointer(document,operation.from),"move"===operation.op&&(returnValue.removed=document),returnValue;if("test"===operation.op){if(returnValue.test=areEquals(document,operation.value),!1===returnValue.test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue.newDocument=document,returnValue}if("remove"===operation.op)return returnValue.removed=document,returnValue.newDocument=null,returnValue;if("_get"===operation.op)return operation.value=document,returnValue;if(validateOperation)throw new exports.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,operation,document);return returnValue}mutateDocument||(document=helpers_1._deepClone(document));var keys=(operation.path||"").split("/"),obj=document,t=1,len=keys.length,existingPathFragment=void 0,key=void 0,validateFunction=void 0;for(validateFunction="function"==typeof validateOperation?validateOperation:validator;;){if(key=keys[t],validateOperation&&void 0===existingPathFragment&&(void 0===obj[key]?existingPathFragment=keys.slice(0,t).join("/"):t==len-1&&(existingPathFragment=operation.path),void 0!==existingPathFragment&&validateFunction(operation,0,document,existingPathFragment)),t++,Array.isArray(obj)){if("-"===key)key=obj.length;else{if(validateOperation&&!helpers_1.isInteger(key))throw new exports.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,operation.path,operation);helpers_1.isInteger(key)&&(key=~~key)}if(t>=len){if(validateOperation&&"add"===operation.op&&key>obj.length)throw new exports.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,operation.path,operation);if(!1===(returnValue=arrOps[operation.op].call(operation,obj,key,document)).test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue}}else if(key&&-1!=key.indexOf("~")&&(key=helpers_1.unescapePathComponent(key)),t>=len){if(!1===(returnValue=objOps[operation.op].call(operation,obj,key,document)).test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return returnValue}obj=obj[key]}}function applyPatch(document,patch,validateOperation){if(validateOperation&&!Array.isArray(patch))throw new exports.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");for(var results=new Array(patch.length),i=0,length_1=patch.length;i<length_1;i++)results[i]=applyOperation(document,patch[i],validateOperation),document=results[i].newDocument;return results.newDocument=document,results}function validator(operation,index,document,existingPathFragment){if("object"!=typeof operation||null===operation||Array.isArray(operation))throw new exports.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",index,operation,document);if(!objOps[operation.op])throw new exports.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",index,operation,document);if("string"!=typeof operation.path)throw new exports.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",index,operation,document);if(0!==operation.path.indexOf("/")&&operation.path.length>0)throw new exports.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",index,operation,document);if(("move"===operation.op||"copy"===operation.op)&&"string"!=typeof operation.from)throw new exports.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&void 0===operation.value)throw new exports.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",index,operation,document);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&helpers_1.hasUndefined(operation.value))throw new exports.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",index,operation,document);if(document)if("add"==operation.op){var pathLen=operation.path.split("/").length,existingPathLen=existingPathFragment.split("/").length;if(pathLen!==existingPathLen+1&&pathLen!==existingPathLen)throw new exports.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",index,operation,document)}else if("replace"===operation.op||"remove"===operation.op||"_get"===operation.op){if(operation.path!==existingPathFragment)throw new exports.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",index,operation,document)}else if("move"===operation.op||"copy"===operation.op){var error=validate([{op:"_get",path:operation.from,value:void 0}],document);if(error&&"OPERATION_PATH_UNRESOLVABLE"===error.name)throw new exports.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",index,operation,document)}}function validate(sequence,document,externalValidator){try{if(!Array.isArray(sequence))throw new exports.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(document)applyPatch(helpers_1._deepClone(document),helpers_1._deepClone(sequence),externalValidator||!0);else{externalValidator=externalValidator||validator;for(var i=0;i<sequence.length;i++)externalValidator(sequence[i],i,document,void 0)}}catch(e){if(e instanceof exports.JsonPatchError)return e;throw e}}var equalsOptions={strict:!0},_equals=require("deep-equal"),areEquals=function(a,b){return _equals(a,b,equalsOptions)},helpers_1=require("./helpers");exports.JsonPatchError=helpers_1.PatchError,exports.deepClone=helpers_1._deepClone;var objOps={add:function(obj,key,document){return obj[key]=this.value,{newDocument:document}},remove:function(obj,key,document){var removed=obj[key];return delete obj[key],{newDocument:document,removed:removed}},replace:function(obj,key,document){var removed=obj[key];return obj[key]=this.value,{newDocument:document,removed:removed}},move:function(obj,key,document){var removed=getValueByPointer(document,this.path);removed&&(removed=helpers_1._deepClone(removed));var originalValue=applyOperation(document,{op:"remove",path:this.from}).removed;return applyOperation(document,{op:"add",path:this.path,value:originalValue}),{newDocument:document,removed:removed}},copy:function(obj,key,document){var valueToCopy=getValueByPointer(document,this.from);return applyOperation(document,{op:"add",path:this.path,value:helpers_1._deepClone(valueToCopy)}),{newDocument:document}},test:function(obj,key,document){return{newDocument:document,test:areEquals(obj[key],this.value)}},_get:function(obj,key,document){return this.value=obj[key],{newDocument:document}}},arrOps={add:function(arr,i,document){return helpers_1.isInteger(i)?arr.splice(i,0,this.value):arr[i]=this.value,{newDocument:document,index:i}},remove:function(arr,i,document){return{newDocument:document,removed:arr.splice(i,1)[0]}},replace:function(arr,i,document){var removed=arr[i];return arr[i]=this.value,{newDocument:document,removed:removed}},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};exports.getValueByPointer=getValueByPointer,exports.applyOperation=applyOperation,exports.applyPatch=applyPatch,exports.applyReducer=function(document,operation){var operationResult=applyOperation(document,operation);if(!1===operationResult.test)throw new exports.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,operation,document);return operationResult.newDocument},exports.validator=validator,exports.validate=validate},{"./helpers":10,"deep-equal":5}],9:[function(require,module,exports){function getMirror(obj){for(var i=0,length=beforeDict.length;i<length;i++)if(beforeDict[i].obj===obj)return beforeDict[i]}function getObserverFromMirror(mirror,callback){for(var j=0,length=mirror.observers.length;j<length;j++)if(mirror.observers[j].callback===callback)return mirror.observers[j].observer}function removeObserverFromMirror(mirror,observer){for(var j=0,length=mirror.observers.length;j<length;j++)if(mirror.observers[j].observer===observer)return void mirror.observers.splice(j,1)}function generate(observer){for(var mirror,i=0,length=beforeDict.length;i<length;i++)if(beforeDict[i].obj===observer.object){mirror=beforeDict[i];break}_generate(mirror.value,observer.object,observer.patches,""),observer.patches.length&&core_1.applyPatch(mirror.value,observer.patches);var temp=observer.patches;return temp.length>0&&(observer.patches=[],observer.callback&&observer.callback(temp)),temp}function _generate(mirror,obj,patches,path){if(obj!==mirror){"function"==typeof obj.toJSON&&(obj=obj.toJSON());for(var newKeys=helpers_1._objectKeys(obj),oldKeys=helpers_1._objectKeys(mirror),deleted=!1,t=oldKeys.length-1;t>=0;t--){var oldVal=mirror[key=oldKeys[t]];if(!helpers_1.hasOwnProperty(obj,key)||void 0===obj[key]&&void 0!==oldVal&&!1===Array.isArray(obj))patches.push({op:"remove",path:path+"/"+helpers_1.escapePathComponent(key)}),deleted=!0;else{var newVal=obj[key];"object"==typeof oldVal&&null!=oldVal&&"object"==typeof newVal&&null!=newVal?_generate(oldVal,newVal,patches,path+"/"+helpers_1.escapePathComponent(key)):oldVal!==newVal&&(!0,patches.push({op:"replace",path:path+"/"+helpers_1.escapePathComponent(key),value:helpers_1._deepClone(newVal)}))}}if(deleted||newKeys.length!=oldKeys.length)for(t=0;t<newKeys.length;t++){var key=newKeys[t];helpers_1.hasOwnProperty(mirror,key)||void 0===obj[key]||patches.push({op:"add",path:path+"/"+helpers_1.escapePathComponent(key),value:helpers_1._deepClone(obj[key])})}}}require("deep-equal");var helpers_1=require("./helpers"),core_1=require("./core"),core_2=require("./core");exports.applyOperation=core_2.applyOperation,exports.applyPatch=core_2.applyPatch,exports.applyReducer=core_2.applyReducer,exports.getValueByPointer=core_2.getValueByPointer,exports.validate=core_2.validate,exports.validator=core_2.validator;var helpers_2=require("./helpers");exports.JsonPatchError=helpers_2.PatchError,exports.deepClone=helpers_2._deepClone,exports.escapePathComponent=helpers_2.escapePathComponent,exports.unescapePathComponent=helpers_2.unescapePathComponent;var beforeDict=[],Mirror=function(){return function(obj){this.observers=[],this.obj=obj}}(),ObserverInfo=function(){return function(callback,observer){this.callback=callback,this.observer=observer}}();exports.unobserve=function(root,observer){observer.unobserve()},exports.observe=function(obj,callback){var observer,patches=[],mirror=getMirror(obj);if(mirror?observer=getObserverFromMirror(mirror,callback):(mirror=new Mirror(obj),beforeDict.push(mirror)),observer)return observer;if(observer={},mirror.value=helpers_1._deepClone(obj),callback){observer.callback=callback,observer.next=null;var dirtyCheck=function(){generate(observer)},fastCheck=function(){clearTimeout(observer.next),observer.next=setTimeout(dirtyCheck)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",fastCheck),window.addEventListener("keyup",fastCheck),window.addEventListener("mousedown",fastCheck),window.addEventListener("keydown",fastCheck),window.addEventListener("change",fastCheck)):(document.documentElement.attachEvent("onmouseup",fastCheck),document.documentElement.attachEvent("onkeyup",fastCheck),document.documentElement.attachEvent("onmousedown",fastCheck),document.documentElement.attachEvent("onkeydown",fastCheck),document.documentElement.attachEvent("onchange",fastCheck)))}return observer.patches=patches,observer.object=obj,observer.unobserve=function(){generate(observer),clearTimeout(observer.next),removeObserverFromMirror(mirror,observer),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",fastCheck),window.removeEventListener("keyup",fastCheck),window.removeEventListener("mousedown",fastCheck),window.removeEventListener("keydown",fastCheck)):(document.documentElement.detachEvent("onmouseup",fastCheck),document.documentElement.detachEvent("onkeyup",fastCheck),document.documentElement.detachEvent("onmousedown",fastCheck),document.documentElement.detachEvent("onkeydown",fastCheck)))},mirror.observers.push(new ObserverInfo(callback,observer)),observer},exports.generate=generate,exports.compare=function(tree1,tree2){var patches=[];return _generate(tree1,tree2,patches,""),patches}},{"./core":8,"./helpers":10,"deep-equal":5}],10:[function(require,module,exports){function hasOwnProperty(obj,key){return _hasOwnProperty.call(obj,key)}function _objectKeys(obj){if(Array.isArray(obj)){for(var keys=new Array(obj.length),k=0;k<keys.length;k++)keys[k]=""+k;return keys}if(Object.keys)return Object.keys(obj);keys=[];for(var i in obj)hasOwnProperty(obj,i)&&keys.push(i);return keys}function escapePathComponent(path){return-1===path.indexOf("/")&&-1===path.indexOf("~")?path:path.replace(/~/g,"~0").replace(/\//g,"~1")}function _getPathRecursive(root,obj){var found;for(var key in root)if(hasOwnProperty(root,key)){if(root[key]===obj)return escapePathComponent(key)+"/";if("object"==typeof root[key]&&""!=(found=_getPathRecursive(root[key],obj)))return escapePathComponent(key)+"/"+found}return""}function hasUndefined(obj){if(void 0===obj)return!0;if(obj)if(Array.isArray(obj)){for(var i=0,len=obj.length;i<len;i++)if(hasUndefined(obj[i]))return!0}else if("object"==typeof obj)for(var objKeys=_objectKeys(obj),objKeysLength=objKeys.length,i=0;i<objKeysLength;i++)if(hasUndefined(obj[objKeys[i]]))return!0;return!1}var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},_hasOwnProperty=Object.prototype.hasOwnProperty;exports.hasOwnProperty=hasOwnProperty,exports._objectKeys=_objectKeys,exports._deepClone=function(obj){switch(typeof obj){case"object":return JSON.parse(JSON.stringify(obj));case"undefined":return null;default:return obj}},exports.isInteger=function(str){for(var charCode,i=0,len=str.length;i<len;){if(!((charCode=str.charCodeAt(i))>=48&&charCode<=57))return!1;i++}return!0},exports.escapePathComponent=escapePathComponent,exports.unescapePathComponent=function(path){return path.replace(/~1/g,"/").replace(/~0/g,"~")},exports._getPathRecursive=_getPathRecursive,exports.getPath=function(root,obj){if(root===obj)return"/";var path=_getPathRecursive(root,obj);if(""===path)throw new Error("Object not found in root");return"/"+path},exports.hasUndefined=hasUndefined;var PatchError=function(_super){function PatchError(message,name,index,operation,tree){_super.call(this,message),this.message=message,this.name=name,this.index=index,this.operation=operation,this.tree=tree}return __extends(PatchError,_super),PatchError}(Error);exports.PatchError=PatchError},{}],11:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],12:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],13:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],14:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":12,"./encode":13}],15:[function(require,module,exports){const EndpointConfig=require("./endpoint-config.class.js"),Endpoint=require("./endpoint.class.js"),Cache=require("./cache.class"),clone=require("./utils.class").clone;class APIConfig{constructor(){this.config={headers:{},url:""},this.endpoints={},this.cache=new Cache}baseUrl(url){return void 0!==url?("string"==typeof url&&(this.config.url=url),this):this.config.url}endpoint(endpointName="__default__"){let config=(new EndpointConfig).api(this);return this[endpointName]=new Endpoint(config),this[endpointName]}commonHeaders(headers){return void 0!==headers?(this.config.headers=headers,this):clone(this.config.headers)}}module.exports=APIConfig},{"./cache.class":16,"./endpoint-config.class.js":17,"./endpoint.class.js":18,"./utils.class":25}],16:[function(require,module,exports){class Cache{constructor(){this.objects=new Map,this.config={ttl:6e4}}get(name){let now=Date.now(),obj=this.objects.get(name);if(void 0!==obj&&now-obj[0]<this.config.ttl){let cachedObject=obj[1];return Object.defineProperty(cachedObject,"__fromCache",{value:!0}),cachedObject}return void this.objects.delete(name)}put(name,value){if("string"!=typeof name)throw new Error("Invalid name attribute");return"string"==typeof value&&(value=new String(value)),"number"==typeof value&&(value=new Number(value)),"boolean"==typeof value&&(value=new Boolean(value)),this.objects.set(name,[Date.now(),value]),!0}invalidate(name){return this.objects.delete(name)}setTTL(newTTL){if("number"!=typeof newTTL)throw new Error("Invalid TTL value");return this.config.ttl=newTTL,!0}}module.exports=Cache},{}],17:[function(require,module,exports){const Model=require("./model.class"),clone=require("./utils.class").clone;class EndpointConfig{constructor(config={}){this.config={api:{}};let defaults={url:"/",responseType:"application/json",instantiator:Model};Object.assign(this.config,defaults,clone(config))}mediaType(newType){return void 0!==newType?("string"==typeof newType&&(this.config.responseType=newType),this):this.config.responseType}api(config){return void 0!==config?("object"==typeof config&&null!==config&&(this.config.api=clone(config)),this):this.config.api}baseUrl(){return this.config.api&&this.config.api.baseUrl?this.config.api.baseUrl():""}url(newUrl){return void 0!==newUrl?("string"==typeof newUrl&&(this.config.url=newUrl),this):this.config.url}model(newFn){return void 0!==newFn?("function"==typeof newFn&&(this.config.instantiator=newFn),this):this.config.instantiator}}module.exports=EndpointConfig},{"./model.class":20,"./utils.class":25}],18:[function(require,module,exports){const URLBuilder=require("./url-builder.class"),Request=require("./request.class"),clone=require("./utils.class").clone,noop=require("./utils.class").noop;class Endpoint{constructor(endpointConfig={}){if(!endpointConfig||"function"!=typeof endpointConfig.model)throw new Error("Invalid endpoint configuration.");this.endpointConfig=clone(endpointConfig),this.config={allowFromCache:!0,method:"get",target:"",query:{}},this.cache=this.endpointConfig.api().cache}createNew(data={}){let root=this.endpointConfig.baseUrl()+this.endpointConfig.url();data["@root"]=root;let instance=new(this.endpointConfig.model())(data);return instance.config(this.endpointConfig),instance}model(instantiator){return void 0!==instantiator?(this.endpointConfig.model(instantiator),this):this.endpointConfig.model()}url(newUrl){return void 0!==newUrl?(this.endpointConfig.url(newUrl),this):this.endpointConfig.url()}findById(id){if("string"!=typeof id)throw new Error("Invalid model identifier");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.config.method="get",this}find(query){return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url()]),this.config.method="get",this.config.query.search=JSON.stringify(query),this}findByIdAndUpdate(id,body){if("string"!=typeof id)throw new Error("Invalid model identifier");if("object"!=typeof body)throw new Error("Invalid body object");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.body=body,this.config.method="put",this}findByIdAndRemove(id){if("string"!=typeof id)throw new Error("Invalid model identifier");return this.config.target=new URLBuilder([this.endpointConfig.baseUrl(),this.endpointConfig.url(),id]),this.config.method="delete",this}allowFromCache(allow){return void 0!==allow?("boolean"==typeof allow&&(this.config.allowFromCache=allow),this):this.config.allowFromCache}exec(cb=noop){let allowFromCache=this.allowFromCache(),modelConstructor=this.endpointConfig.model(),endpointConfig=this.endpointConfig,headers={};try{headers=this.endpointConfig.api().commonHeaders()}catch(e){}Object.assign(headers,this.config.headers);let request=(new Request).method(this.config.method).body(this.config.body||{}).query(this.config.query||{}).headers(headers||{}).url(this.config.target.toString());return new(require("./settings").getPromise())((resolve,reject)=>{if(this.hasCache()){let cachedObject=cache.get(request.url());if(cachedObject&&allowFromCache)return cb(null,cachedObject),resolve(cachedObject)}request.exec().then(response=>{let model,data=response.data;return Array.isArray(data)?model=data.map(item=>{let entry=new modelConstructor(item);return entry.config(endpointConfig),Object.defineProperty(entry,"__request",{value:clone(request),enumerable:!1}),entry}):((model=new modelConstructor(data)).config(endpointConfig),Object.defineProperty(model,"__request",{value:clone(request),enumerable:!1})),this.hasCache()&&cache.put(request.url(),model),cb(null,model),resolve(model)}).catch(err=>(this.hasCache()&&cache.invalidate(request.url()),cb(err),reject(err)))})}skip(skipAmount=0){return"number"==typeof skipAmount&&(this.config.query.skip=skipAmount),this}limit(limitAmount=0){return"number"==typeof limitAmount&&(this.config.query.limit=limitAmount),this}select(fields=""){return Array.isArray(fields)&&(fields=fields.join(" ")),"string"==typeof fields&&(this.config.query.fields=fields),this}hasCache(){return this.cache&&"function"==typeof this.cache}}module.exports=Endpoint},{"./request.class":21,"./settings":22,"./url-builder.class":24,"./utils.class":25}],19:[function(require,module,exports){class HTTPMock{constructor(verbose=!1){this.listeners={},this.verbose=verbose}open(method,url){this.log(`Opening ${url} using ${method}`)}send(body){if(this.log(`Sending with ${body}`),"function"==typeof this.listeners.load){let mockResponse={response:{mock_response:!0,data:["obj1"]},responseText:"{'mock_response' : true}",status:200,statusText:"200",responseURL:"/mock-call"};Object.assign(this,mockResponse),this.listeners.load()}}getAllResponseHeaders(){return"Mock-Headers: true"}addEventListener(name,callback){this.log(`${name} listener registered`),this.listeners[name]=callback}setRequestHeader(header,value){return!0}log(message){!0===this.verbose&&console.log(message)}}module.exports=HTTPMock},{}],20:[function(require,module,exports){const jsonpatch=require("fast-json-patch"),clone=require("./utils.class").clone,noop=require("./utils.class").noop,Request=require("./request.class");class Model{constructor(data={}){Object.defineProperty(this,"__config",{enumerable:!1,writable:!0}),Object.defineProperty(this,"__response",{enumerable:!1,writable:!0}),Object.defineProperty(this,"__original",{value:data,writable:!0}),Object.defineProperty(this,"__revision",{value:Date.now(),writable:!0}),Object.assign(this,clone(data))}save(cb=noop){let headers={};try{headers=this.__config.api().commonHeaders()}catch(e){}let method=this.id?"put":"post",instance=this;return(new Request).url(this.makeHref()).method(method).headers(headers).body(this).exec().then(response=>(Object.assign(instance,clone(response.data)),instance.__revision=Date.now(),instance.__response=response,instance.makeClean(),cb(),instance)).catch(err=>{cb(err)})}changes(){let headers=this.__config.api().commonHeaders(),targetUrl=this["@changes"];return(new Request).url(targetUrl).query({search:{since:this.__revision}}).method("get").headers(headers).exec()}subscribe(onChange,ttl=3e3){return setInterval(()=>{this.changes().then(changeList=>{changeList&&changeList.length&&(this.__revision=Date.now(),onChange(changeList,Date.now()))})},ttl),this}update(){let headers=this.__config.api().commonHeaders(),patches=this.getDiffs(),targetUrl=this.makeHref(),instance=this;return(new Request).url(targetUrl).method("patch").headers(headers).body(patches).exec().then(response=>{Object.assign(instance,clone(response.data)),instance.__revision=Date.now(),instance.__response=response,instance.makeClean()})}config(endpointConfig={}){this.__config=endpointConfig}makeHref(){let correctHref;return"object"==typeof this.__config?(correctHref=this.__config.baseUrl()+this.__config.url(),"string"==typeof this.id&&(correctHref+=this.id)):correctHref="/__unit_test__",correctHref}getDiffs(){return jsonpatch.compare(this.__original,this)}isDirty(){return this.getDiffs().length>0}makeClean(){this.__original=clone(this)}remove(cb=noop){let headers={};try{headers=this.__config.api().commonHeaders()}catch(e){}let targetUrl=this.makeHref(),instance=this;return(new Request).url(targetUrl).method("delete").headers(headers).exec().then(response=>(instance.__response=response,cb())).catch(err=>cb(err))}}module.exports=Model},{"./request.class":21,"./utils.class":25,"fast-json-patch":9}],21:[function(require,module,exports){const Transport=require("./transport.class.js"),clone=require("./utils.class").clone;class Request{constructor(config={}){var defaults={method:"GET",url:"/",headers:{},data:void 0,responseType:"application/json",params:{}};this.config={},Object.assign(this.config,defaults,config)}exec(){let originalRequest=this;return new(require("./settings").getPromise())((resolve,reject)=>{originalRequest.transport=new Transport(originalRequest),originalRequest.transport.exec().then(function(response){return response.data=clone(response.response),response.request=originalRequest,resolve(response)},function(response){return response.request=originalRequest,reject(response)})})}query(newQuery){return void 0!==newQuery?("object"==typeof newQuery&&null!==newQuery&&(newQuery=clone(newQuery)),this.config.params=newQuery,this):this.config.params}method(newMethod){return void 0!==newMethod?("string"==typeof newMethod&&(this.config.method=newMethod),this):this.config.method}url(newUrl){return void 0!==newUrl?("string"==typeof newUrl&&(this.config.url=newUrl),this):this.config.url}headers(newHeaderObj){return void 0!==newHeaderObj?("object"==typeof newHeaderObj&&null!==newHeaderObj&&(this.config.headers=clone(newHeaderObj)),this):this.config.headers}body(newBody){return void 0!==newBody?("object"==typeof newBody&&null!==newBody&&(this.config.data=clone(newBody)),this):this.config.data}mediaType(newType){return void 0!==newType?("string"==typeof newType&&(this.config.responseType=newType),this):this.config.responseType}toJSON(){return clone(this.config)}}module.exports=Request},{"./settings":22,"./transport.class.js":23,"./utils.class":25}],22:[function(require,module,exports){let settings={_p:Promise,setPromiseLib:function(p){this._p=p},getPromise:function(){return this._p}};module.exports=settings},{}],23:[function(require,module,exports){const clone=require("./utils.class").clone,querystring=require("querystring");class Transport{constructor(request){"undefined"!=typeof window&&window.XMLHttpRequest?this.HTTPRequest=window.XMLHttpRequest:this.HTTPRequest=require("./http-mock.class.js"),this.setRequest(request)}setRequest(request){return this.request=clone(request),this}exec(){let instance=this;return new(require("./settings").getPromise())((resolve,reject)=>{let httpInstance=new instance.HTTPRequest,url=instance.request.url(),query=querystring.stringify(instance.request.query());query&&query.length&&(url=url+"?"+query);let body=instance.request.body();"object"==typeof body&&(body=JSON.stringify(body)),httpInstance.addEventListener("load",function(){httpInstance.status<400?resolve(httpInstance):reject(httpInstance)}),httpInstance.addEventListener("error",function(e){reject(httpInstance)}),httpInstance.addEventListener("abort",function(){let failed=new Error("Transfer cancelled.");reject(failed)}),httpInstance.open(instance.request.method().toUpperCase(),url),httpInstance.responseType="json";let headers=instance.request.headers();httpInstance.setRequestHeader("Content-Type",instance.request.mediaType());for(let headerName in headers)httpInstance.setRequestHeader(headerName,headers[headerName]);httpInstance.send(body)})}}module.exports=Transport},{"./http-mock.class.js":19,"./settings":22,"./utils.class":25,querystring:14}],24:[function(require,module,exports){class URLBuilder{constructor(args=[]){if(!args||"function"!=typeof args.join)throw new Error("URL Builder requires param 1 to be an array.");this.target=args.filter(item=>"/"!==item).join("/")||"/"}toString(){return this.target||""}}module.exports=URLBuilder},{}],25:[function(require,module,exports){var clone_lib=require("clone");class Utils{constructor(){}static noop(){}static clone(obj){return clone_lib(obj)}}module.exports=Utils},{clone:4}]},{},[1])(1)});
